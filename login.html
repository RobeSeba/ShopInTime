<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ShopinTime – Login</title>
  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500&display=swap" rel="stylesheet">
  <!-- estilos enlazados al css -->
  <link rel="stylesheet" href="css/login.css">
</head>
<body>
  <header class="app">
    <a href="index.html" class="brand" style="text-decoration:none; color:inherit;"><div class="logo"></div><h1>Shop in Time</h1></a>
    <div id="user-info" class="hidden">
      <span id="user-name"></span>
      <button id="logout-btn" style="margin-left:8px; padding:8px 12px; border-radius:8px; border:none; background:#ffffff22; color:#fff; cursor:pointer">Cerrar sesión</button>
    </div>
  </header>

  <!-- LOGIN/REGISTER SLIDE -->
  <div class="wrap">
    <div class="main">  
      <input type="checkbox" id="chk" aria-hidden="true">

      <!-- SIGN UP -->
      <div class="signup">
        <form id="signup-form" class="panel" autocomplete="off">
          <label for="chk" aria-hidden="true" class="title">Registro</label>
          <input type="text" id="su-name" placeholder="Nombre completo" required>
          <input type="email" id="su-email" placeholder="Email" required>
          <input type="tel" id="su-phone" placeholder="Teléfono" required>
          <input type="password" id="su-pass" placeholder="Contraseña" required>
          <!-- Por defecto, el registro crea Cliente -->
          <button type="submit">Crear cuenta</button>
        </form>
      </div>

      <!-- LOGIN -->
      <div class="login">
        <form id="login-form" class="panel" autocomplete="on">
          <label for="chk" aria-hidden="true" class="title">Ingresar</label>
          <input type="text" id="name" name="name" placeholder="Nombre completo" required />
          <input type="email" id="email" name="email" placeholder="Correo electrónico" required />
          <input type="password" id="password" name="password" placeholder="Contraseña" required />
          <!-- No required para permitir login admin sin seleccionar rol -->
          <select id="role" name="role">
            <option value="" disabled selected>Selecciona rol</option>
            <option value="cliente">Cliente</option>
            <option value="empresa">Empresa</option>
          </select>
          <button type="submit">Entrar</button>
          <p id="login-msg" style="color:#b30000; font-size:.95rem; margin:6px 0 0; text-align:center"></p>
        </form>
      </div>

    </div>
  </div>

  <!-- CONTENIDO DE CLIENTE (DEMO) -->
  <section id="index-content" class="container hidden">
    <div class="card">
      <h2 style="margin-top:0">Bienvenido a ShopinTime</h2>
      <p>Contenido público / cliente. Aquí irá tu interfaz principal para clientes.</p>
    </div>
  </section>

  <script>
  (function(){
    // ======= Credenciales admin internas (no visibles en UI) =======
    const ADMIN_EMAIL = "floresyemile45@gmail.com";
    const ADMIN_PASS  = "#Km18";

    const loginSectionCard = document.querySelector('.wrap');
    const loginForm  = document.getElementById('login-form');
    const loginMsg   = document.getElementById('login-msg');
    const indexContent = document.getElementById('index-content');
    const userInfo   = document.getElementById('user-info');
    const userNameSpan = document.getElementById('user-name');
    const logoutBtn  = document.getElementById('logout-btn');

    const signupForm = document.getElementById('signup-form');

    function showLogin(){
      loginSectionCard.classList.remove('hidden');
      indexContent.classList.add('hidden');
      userInfo.classList.add('hidden');
    }
    function redirectToIndex(){ window.location.href = 'index.html'; }
    function redirectToEmpresa(){ window.location.href = 'empresa.html'; }
    function redirectToAdmin(){ window.location.href = 'admi.html'; }

    // ======= Registro rápido: crea usuario Cliente por defecto =======
    signupForm.addEventListener('submit', function(e){
      e.preventDefault();
      const name = document.getElementById('su-name').value.trim();
      const email= document.getElementById('su-email').value.trim();
      const phone= document.getElementById('su-phone').value.trim();
      const pass = document.getElementById('su-pass').value;
      if(!name || !email || !phone || !pass){
        // puedes mostrar mensaje aquí si quieres
        return;
      }
      // Persistencia mínima demo
      sessionStorage.setItem('userRole','cliente');
      sessionStorage.setItem('userName',name);
      sessionStorage.setItem('userEmail',email);
      // Redirigir cliente a index.html
      redirectToIndex();
    });

    // ======= Login =======
    loginForm.addEventListener('submit', function(e){
      e.preventDefault();
      loginMsg.textContent = '';
      const name = document.getElementById('name').value.trim();
      const email= document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const role = document.getElementById('role').value;

      if(!name || !email || !password){
        loginMsg.textContent = 'Completa nombre, correo y contraseña.'; return;
      }

      // Admin (interno) — se permite sin seleccionar rol
      if(email === ADMIN_EMAIL && password === ADMIN_PASS){
        sessionStorage.setItem('userRole','admin');
        sessionStorage.setItem('userName',name);
        sessionStorage.setItem('userEmail',email);
        redirectToAdmin();
        return;
      }

      // Para empresa/cliente se requiere seleccionar rol
      if(!role){
        loginMsg.textContent = 'Selecciona un rol (Cliente o Empresa).'; return;
      }

      // Empresa
      if(role === 'empresa'){
        sessionStorage.setItem('userRole','empresa');
        sessionStorage.setItem('userName',name);
        sessionStorage.setItem('userEmail',email);
        redirectToEmpresa();
        return;
      }
      // Cliente
      if(role === 'cliente'){
        sessionStorage.setItem('userRole','cliente');
        sessionStorage.setItem('userName',name);
        sessionStorage.setItem('userEmail',email);
        redirectToIndex();
        return;
      }

      loginMsg.textContent = 'Rol no reconocido.';
    });

    logoutBtn.addEventListener('click', function(){
      sessionStorage.clear();
      // quedamos en la misma página de login
      showLogin();
    });

    // ======= Auto-estado =======
    (function init(){
      const role = sessionStorage.getItem('userRole');
      const name = sessionStorage.getItem('userName');
      const email= sessionStorage.getItem('userEmail');
      if(!role){ showLogin(); return; }
      if(role === 'admin'){ redirectToAdmin(); return; }
      if(role === 'empresa'){ redirectToEmpresa(); return; }
      if(role === 'cliente'){ redirectToIndex(); return; }
      showLogin();
    })();
  })();
  </script>

  <script src="js/login.js"></script>
</body>
</html>
